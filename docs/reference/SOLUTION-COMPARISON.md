# 方案对比速查表

## 三种方案对比

| 维度 | 方案1: 全量 | 方案2: 采样 | 方案3: 混合 ⭐ |
|------|-----------|-----------|--------------|
| **数据量** | 560条/秒 | 56条/秒 | 560→56条/秒 |
| **年成本(云)** | $13,800 | $7,320 | $9,600 |
| **节省比例** | - | **-47%** | **-30%** |
| **实时告警** | ✅ 完美 | ⚠️ 有遗漏 | ✅ 完美 |
| **历史分析** | ✅ 最详细 | ✅ 足够 | ✅ 足够 |
| **存储/年** | 13 TB | 1.5 TB | 1.5 TB |

---

## 配置对比

### 方案 1: 全量存储

```
Redpanda:     3 × (4C 8G 500GB)
Connect:      3 × (2C 4G)
TimescaleDB:  1 × (8C 16G 2TB)
总成本:       $13,800/年
```

### 方案 2: 10秒采样

```
Redpanda:     3 × (2C 4G 200GB)  ⬇️ 50%
Connect:      2 × (2C 2G)        ⬇️ 60%
TimescaleDB:  1 × (4C 8G 1TB)    ⬇️ 50%
总成本:       $7,320/年  💰 节省 47%
```

### 方案 3: 混合双轨 ⭐

```
Redpanda:       3 × (3C 6G 300GB)
Connect-告警:    2 × (2C 2G)  # 全量,仅检测
Connect-存储:    2 × (2C 2G)  # 采样,存储
TimescaleDB:    1 × (4C 8G 1TB)
总成本:         $9,600/年  💰 节省 30%
```

---

## 实现代码片段

### 采样逻辑 (Bloblang)

```yaml
pipeline:
  processors:
    - mapping: |
        # 10秒采样:只保留秒数是10倍数的数据
        let ts_seconds = this.timestamp.second
        root = if ($ts_seconds % 10) == 0 {
          this
        } else {
          deleted()
        }
```

### 混合方案架构

```
原始数据(560/s)
    │
    ├─→ 告警Connect(全量) → 仅告警,不存储
    │
    └─→ 存储Connect(采样) → 10s采样 → TimescaleDB
```

---

## 选择建议

### 🔍 成本优先 → 方案2 (采样)
- 成本最低
- 历史分析足够
- 可接受告警延迟

### ⚡ 性能优先 → 方案1 (全量)
- 实时性最好
- 数据最完整
- 成本最高

### ⭐ 平衡推荐 → 方案3 (混合)
- 告警实时(全量)
- 存储节省(采样)
- 性价比最高

---

详见: [07-optimized-sampling-strategy.md](./07-optimized-sampling-strategy.md)
