input:
  kafka:
    addresses:
      - redpanda-1:9092
      - redpanda-2:9092
      - redpanda-3:9092
    topics:
      - signal.parsed.v1
    consumer_group: macda-storage-v1
    start_from_oldest: false
    commit_period: 1s

pipeline:
  threads: 4
  processors:
    - mapping: |
        root = {
          "schema_version": this.schema_version,
          "event_time_text": this.event_time_text,
          "event_time_valid": this.event_time_valid,
          "ingest_time": this.ingest_time,
          "process_time": this.process_time,

          "line_id": this.line_id,
          "train_id": this.train_id,
          "carriage_id": this.carriage_id,
          "device_id": this.device_id,
          "frame_no": this.frame_no,

          "parser_version": this.parser_version,
          "quality_code": this.quality_code,

          "wmode_u1": this.raw.WmodeU1,
          "wmode_u2": this.raw.WmodeU2,

          "f_cp_u11": this.raw.FCpU11,
          "f_cp_u12": this.raw.FCpU12,
          "f_cp_u21": this.raw.FCpU21,
          "f_cp_u22": this.raw.FCpU22,

          "i_cp_u11": this.raw.ICpU11,
          "i_cp_u12": this.raw.ICpU12,
          "i_cp_u21": this.raw.ICpU21,
          "i_cp_u22": this.raw.ICpU22,

          "suckp_u11": this.raw.SuckpU11,
          "suckp_u12": this.raw.SuckpU12,
          "suckp_u21": this.raw.SuckpU21,
          "suckp_u22": this.raw.SuckpU22,

          "highpress_u11": this.raw.HighpressU11,
          "highpress_u12": this.raw.HighpressU12,
          "highpress_u21": this.raw.HighpressU21,
          "highpress_u22": this.raw.HighpressU22,

          "fas_u1": this.raw.FasU1,
          "fas_u2": this.raw.FasU2,
          "ras_u1": this.raw.RasU1,
          "ras_u2": this.raw.RasU2,

          "presdiff_u1": this.raw.PresdiffU1,
          "presdiff_u2": this.raw.PresdiffU2,

          "aq_co2_u1": this.raw.AqCo2U1,
          "aq_co2_u2": this.raw.AqCo2U2,
          "aq_tvoc_u1": this.raw.AqTvocU1,
          "aq_tvoc_u2": this.raw.AqTvocU2,
          "aq_pm2_5_u1": this.raw.AqPm25U1,
          "aq_pm2_5_u2": this.raw.AqPm25U2,
          "aq_pm10_u1": this.raw.AqPm10U1,
          "aq_pm10_u2": this.raw.AqPm10U2,

          "bocflt_ef_u11": this.raw.BocfltEfU11,
          "bocflt_ef_u12": this.raw.BocfltEfU12,
          "bocflt_ef_u21": this.raw.BocfltEfU21,
          "bocflt_ef_u22": this.raw.BocfltEfU22,
          "bocflt_cf_u11": this.raw.BocfltCfU11,
          "bocflt_cf_u12": this.raw.BocfltCfU12,
          "bocflt_cf_u21": this.raw.BocfltCfU21,
          "bocflt_cf_u22": this.raw.BocfltCfU22,
          "blpflt_comp_u11": this.raw.BlpfltCompU11,
          "blpflt_comp_u12": this.raw.BlpfltCompU12,
          "blpflt_comp_u21": this.raw.BlpfltCompU21,
          "blpflt_comp_u22": this.raw.BlpfltCompU22,
          "bscflt_comp_u11": this.raw.BscfltCompU11,
          "bscflt_comp_u12": this.raw.BscfltCompU12,
          "bscflt_comp_u21": this.raw.BscfltCompU21,
          "bscflt_comp_u22": this.raw.BscfltCompU22,
          "bflt_tempover": this.raw.BfltTempover,
          "bflt_diffpres_u1": this.raw.BfltDiffpresU1,
          "bflt_diffpres_u2": this.raw.BfltDiffpresU2,

          "payload_json": this
        }

output:
  kafka:
    addresses:
      - redpanda-1:9092
      - redpanda-2:9092
      - redpanda-3:9092
    topic: signal.storage.fact_raw.v1
    key: ${! this.device_id }
    partitioner: round_robin
    max_in_flight: 64
    compression: snappy
    batching:
      count: 300
      period: 200ms

logger:
  level: INFO
  format: json

metrics:
  prometheus:
    add_process_metrics: true
    add_go_metrics: true
