input:
  kafka:
    addresses:
      - 192.168.32.17:19092
    topics:
      - signal-in
    consumer_group: macda-phase1-parser
    start_from_oldest: false

pipeline:
  processors:
    - nb67_parser:
        log_sample_every: 100
    - mapping: |
        root = this

        # 时间戳标准化（基于源设备时间字段）
        root.timestamp = (
          "%04d-%02d-%02d %02d:%02d:%02d".format(
            this.src_year + 2000,
            this.src_month,
            this.src_day,
            this.src_hour,
            this.src_minute,
            this.src_second
          )
        ).parse_timestamp("2006-01-02 15:04:05")

        # 设备标识（最小字段集）
        root.device_id = "HVAC-%05d-%02d".format(this.train_no, this.carriage_no)

        # 车站信息（Offset 452-460）
        root.route_info = {
          "start_station": this.start_station,
          "terminal_station": this.terminal_station,
          "current_station": this.cur_station,
          "next_station": this.next_station,
          "exhaust_damper_position": this.dmp_exu_pos
        }

output:
  kafka:
    addresses:
      - 192.168.32.17:19092
    topic: signal-parsed-phase1
    max_in_flight: 64
    compression: snappy
    batching:
      count: 100
      period: 200ms

http:
  address: 0.0.0.0:4195
  enabled: true
  root_path: /

logger:
  level: INFO
  format: json
